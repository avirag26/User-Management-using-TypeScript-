<body class="bg-dark text-light">
  <!-- Header Section -->
  <div class="container-fluid py-3 bg-secondary">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="h3">Admin Dashboard</h1>
      <a href="/admin/logout">
        <button class="btn btn-outline-light ms-auto" type="button">
          Logout
        </button>
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mt-4">
    <!-- Add User Button and Search Bar -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <input
        type="text"
        id="searchBar"
        class="form-control w-50"
        placeholder="Search by name or email..."
        oninput="filterUsers()"
      />
    </div>

    <!-- User Table -->
    <div class="table-responsive">
      <table class="table table-dark table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">Number</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody id="userTableBody">
          <% users.forEach((user, index) => { %>
          <tr>
            <td><%= index+1 %></td>
            <td><%= user.username %></td>
            <td><%= user.email %></td>
            <td>
              <button
                class="btn btn-danger btn-sm"
                onclick="deleteUser('<%= user._id %>')"
              >
                Delete
              </button>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- /////////////// -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <!-- Toast structure for success -->
    <!-- Toast structure for success -->
    <div
      id="successToast"
      class="toast align-items-center text-white bg-success border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body" id="successToastMessage">Default message</div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Close"
        ></button>
      </div>
    </div>

    <!-- Toast structure for error -->
    <div
      id="errorToast"
      class="toast align-items-center text-white bg-danger border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    >
      <div class="d-flex">
        <div class="toast-body" id="errorToastMessage">Error message</div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Close"
        ></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Filter users in the table
    function filterUsers() {
      const query = document.getElementById('searchBar').value.toLowerCase();
      const rows = document.querySelectorAll('#userTableBody tr');
      rows.forEach(row => {
        const name = row.children[1].textContent.toLowerCase();
        const email = row.children[2].textContent.toLowerCase();
        row.style.display =
          name.includes(query) || email.includes(query) ? '' : 'none';
      });
    }

    // Delete User
    async function deleteUser(userId) {
      if (confirm('Are you sure you want to delete this user?')) {
        console.log(userId);
        try {
          const response = await fetch(`/admin/delete-user/${userId}`, {
            method: 'DELETE',
          });
          const data = await response.json();
          console.log(data);

          if (!data.success) {
            return showToast(
              data.message || 'Something went wrong',
              'errorToast'
            );
          }

          setTimeout(() => {
            window.location.reload();
          }, 2000);
          showToast('Deleted Successfully');
        } catch (error) {
          showToast('Something went wrong', 'errorToast');
        }
      }
    }

    function showToast(message, type = 'successToast') {
      const toastElement = document.getElementById(type);
      const messageElement = document.getElementById(type + 'Message');

      if (!toastElement || !messageElement) {
        console.error(`Toast or message element not found for ${type}`);
        return;
      }

      messageElement.innerHTML = message;

      const toast = new bootstrap.Toast(toastElement, { delay: 2000 });
      toast.show();
    }
  </script>
</body>
